# æ™ºèƒ½å‡ºé¢˜ç³»ç»Ÿ - å¯è§†åŒ–æµç¨‹å›¾

## å®Œæ•´ç³»ç»Ÿæµç¨‹å›¾

```mermaid
flowchart TD
    Start([ğŸš€ å¼€å§‹]) --> Router[Router Node<br/>ğŸ“Š è·¯ç”±å†³ç­–]
    
    Router -->|ğŸ’° é‡‘èç±»<br/>retry_count=0| Finance[Finance Node<br/>ğŸ“ 1. ç…§çŒ«ç”»è™<br/>ğŸ§® 2. è®¡ç®—æ­¥éª¤åˆ†æ<br/>ğŸ”§ 3. å†³å®šè®¡ç®—<br/>âœï¸ 4. ç”Ÿæˆåˆç¨¿]
    Router -->|âš–ï¸ æ³•å¾‹ç±»/ç»¼åˆç±»<br/>retry_count=0| Specialist[Specialist Node<br/>ğŸ“ 1. ç…§çŒ«ç”»è™<br/>âœï¸ 2. ç”Ÿæˆåˆç¨¿]
    
    Finance --> Writer[Writer Node<br/>ğŸ“‹ æ ¼å¼åŒ–æ ‡å‡†åŒ–]
    Specialist --> Writer
    
    Writer --> Critic[Critic Node<br/>ğŸ” è´¨é‡éªŒè¯<br/>ğŸ“Š å‚æ•°æå–<br/>âœ… è®¡ç®—æ­¥éª¤éªŒè¯]
    
    Critic -->|âœ… é€šè¿‡| End([ğŸ‰ è¾“å‡ºé¢˜ç›®])
    Critic -->|âš ï¸ éœ€ä¿®å¤<br/>retry_count<2| Decision{ğŸ”€ ä¿®å¤å†³ç­–}
    Critic -->|ğŸ”„ retry_countâ‰¥3| SelfHeal[ğŸ›¡ï¸ è‡ªæ„ˆæœºåˆ¶<br/>é‡æ–°ç”Ÿæˆ<br/>bypass Router]
    
    Decision -->|ğŸ”§ è½»å¾®é—®é¢˜| Fixer[Fixer Node<br/>ğŸ”¨ æœ¬åœ°ä¿®å¤]
    Decision -->|âŒ ä¸¥é‡é—®é¢˜| Router
    
    Fixer --> Critic
    SelfHeal --> End
    
    style Start fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    style Router fill:#e1f5ff,stroke:#0066cc,stroke-width:3px
    style Finance fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style Specialist fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style Writer fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style Critic fill:#ffe1e1,stroke:#cc0000,stroke-width:3px
    style Fixer fill:#e1ffe1,stroke:#4caf50,stroke-width:2px
    style Decision fill:#ffe1ff,stroke:#cc00cc,stroke-width:2px
    style SelfHeal fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style End fill:#e1ffe1,stroke:#00cc00,stroke-width:3px
```

## è¯¦ç»†æµç¨‹è¯´æ˜å›¾

```mermaid
flowchart LR
    subgraph é˜¶æ®µ1["ğŸ“‹ é˜¶æ®µ1: è·¯ç”±ä¸ç”Ÿæˆ"]
        A[ç”¨æˆ·è¾“å…¥<br/>kb_chunk + question_type<br/>+ generation_mode] --> B[Router Node<br/>åˆ†æçŸ¥è¯†ç‚¹<br/>è®¡ç®—ç›¸å…³åº¦<br/>æå–æŒæ¡ç¨‹åº¦]
        B --> C1[Finance Node<br/>ç…§çŒ«ç”»è™<br/>è®¡ç®—æ­¥éª¤åˆ†æ<br/>å†³å®šè®¡ç®—<br/>ç”Ÿæˆåˆç¨¿]
        B --> C2[Specialist Node<br/>ç…§çŒ«ç”»è™<br/>ç”Ÿæˆåˆç¨¿]
        C1 --> D[Writer Node<br/>æ ¼å¼åŒ–æ ‡å‡†åŒ–]
        C2 --> D
    end
    
    subgraph é˜¶æ®µ2["ğŸ” é˜¶æ®µ2: è´¨é‡éªŒè¯"]
        D --> E[Critic Node<br/>å‚æ•°æå–<br/>è®¡ç®—æ­¥éª¤éªŒè¯<br/>éªŒè¯ç­”æ¡ˆ<br/>éªŒè¯è§£æ]
        E --> F{éªŒè¯ç»“æœ}
        F -->|é€šè¿‡| G[âœ… è¾“å‡ºé¢˜ç›®]
        F -->|éœ€ä¿®å¤| H[åˆ¤æ–­ retry_count]
    end
    
    subgraph é˜¶æ®µ3["ğŸ”„ é˜¶æ®µ3: é”™è¯¯å¤„ç†"]
        H -->|retry_count<2| I{é—®é¢˜ç±»å‹}
        H -->|retry_countâ‰¥3| J[è‡ªæ„ˆè¾“å‡º]
        I -->|è½»å¾®é—®é¢˜| K[Fixer Node<br/>æœ¬åœ°ä¿®å¤]
        I -->|ä¸¥é‡é—®é¢˜| B
        K --> E
        J --> G
    end
    
    style é˜¶æ®µ1 fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style é˜¶æ®µ2 fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style é˜¶æ®µ3 fill:#fce4ec,stroke:#c2185b,stroke-width:2px
```

## å¾ªç¯æœºåˆ¶è¯¦è§£å›¾

```mermaid
flowchart TD
    Router[Router Node] --> Agent{Agent é€‰æ‹©}
    Agent -->|é‡‘èç±»| Finance[Finance Node]
    Agent -->|æ³•å¾‹/ç»¼åˆç±»| Specialist[Specialist Node]
    
    Finance --> Writer[Writer Node]
    Specialist --> Writer
    
    Writer --> Critic[Critic Node<br/>è´¨é‡éªŒè¯]
    
    Critic -->|é€šè¿‡| End([âœ… è¾“å‡ºé¢˜ç›®])
    Critic -->|ç­”æ¡ˆé”™è¯¯| Router
    Critic -->|è§£æé—®é¢˜| Fixer[Fixer Node]
    
    Fixer --> Critic
    
    Critic -->|retry_countâ‰¥3| SelfHeal[è‡ªæ„ˆè¾“å‡º]
    SelfHeal --> End
    
    style Router fill:#e1f5ff,stroke:#0066cc,stroke-width:3px
    style Finance fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style Specialist fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style Writer fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style Critic fill:#ffe1e1,stroke:#cc0000,stroke-width:3px
    style Fixer fill:#e1ffe1,stroke:#4caf50,stroke-width:2px
    style SelfHeal fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    style End fill:#e1ffe1,stroke:#00cc00,stroke-width:3px
```

## Finance Node è®¡ç®—æµç¨‹è¯¦è§£

```mermaid
flowchart TD
    Start([å¼€å§‹]) --> Examples[ğŸ“š ç…§çŒ«ç”»è™<br/>è·å–æ¯é¢˜èŒƒä¾‹]
    Examples --> Analysis[ğŸ§® è®¡ç®—æ­¥éª¤åˆ†æ]
    
    Analysis --> Q1{æ˜¯å¦éœ€è¦<br/>å¤šæ­¥è®¡ç®—?}
    Q1 -->|æ˜¯| Step1[æ­¥éª¤1: ä½¿ç”¨è®¡ç®—å™¨<br/>è®¡ç®—ä¸­é—´ç»“æœ<br/>å¦‚: æˆ¿é¾„]
    Q1 -->|å¦| Direct[ç›´æ¥è®¡ç®—<br/>æœ€ç»ˆç»“æœ]
    
    Step1 --> Step2[æ­¥éª¤2: åŸºäºæ­¥éª¤1<br/>è¿›ä¸€æ­¥è®¡ç®—<br/>å¦‚: è´·æ¬¾å¹´é™ = 50 - æˆ¿é¾„]
    Step2 --> Step3[æ­¥éª¤3: è€ƒè™‘å…¶ä»–å› ç´ <br/>å¦‚: å€Ÿæ¬¾äººå¹´é¾„<br/>å–æœ€å°å€¼]
    Step3 --> Extract[ğŸ“Š æå–å‚æ•°<br/>å¿…é¡»æ˜¯å…·ä½“æ•°å€¼<br/>ä¸èƒ½æ˜¯æè¿°æ€§æ–‡å­—]
    
    Direct --> Extract
    Extract --> Calc[ğŸ”§ è°ƒç”¨è®¡ç®—å™¨]
    Calc --> Generate[âœï¸ ç”Ÿæˆåˆç¨¿<br/>æ ¹æ® generation_mode<br/>çµæ´»/ä¸¥è°¨]
    
    Generate --> End([å®Œæˆ])
    
    style Start fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style Examples fill:#fff4e1,stroke:#ff9800,stroke-width:2px
    style Analysis fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style Extract fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Calc fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style Generate fill:#e1f5ff,stroke:#0066cc,stroke-width:2px
    style End fill:#e1ffe1,stroke:#00cc00,stroke-width:2px
```

## Critic Node éªŒè¯æµç¨‹è¯¦è§£

```mermaid
flowchart TD
    Start([å¼€å§‹]) --> Extract[ğŸ“Š å‚æ•°æå–<br/>ä»é¢˜ç›®ä¸­æå–å…·ä½“æ•°å€¼<br/>ä¸èƒ½æ˜¯æè¿°æ€§æ–‡å­—]
    
    Extract --> Check{èƒ½å¦<br/>æå–å‚æ•°?}
    Check -->|å¦| Skip[è·³è¿‡è®¡ç®—å™¨éªŒè¯]
    Check -->|æ˜¯| Calc[ğŸ”§ è°ƒç”¨è®¡ç®—å™¨éªŒè¯]
    
    Calc --> StepAnalysis[âœ… è®¡ç®—æ­¥éª¤åˆ†æ<br/>ç†è§£è®¡ç®—å™¨å¯èƒ½åªæ˜¯<br/>è§£å†³ä¸€ä¸ªæ­¥éª¤]
    
    StepAnalysis --> Q1{è®¡ç®—å™¨ç»“æœ<br/>æ˜¯æœ€ç»ˆç­”æ¡ˆ?}
    Q1 -->|æ˜¯| DirectVerify[ç›´æ¥å¯¹æ¯”<br/>è®¡ç®—ç»“æœå’Œé¢˜ç›®ç­”æ¡ˆ]
    Q1 -->|å¦| MultiStep[éªŒè¯å®Œæ•´è®¡ç®—è¿‡ç¨‹<br/>æ­¥éª¤1: è®¡ç®—å™¨ç»“æœ<br/>æ­¥éª¤2: åŸºäºæ­¥éª¤1çš„è®¡ç®—<br/>æ­¥éª¤3: è€ƒè™‘å…¶ä»–å› ç´ ]
    
    DirectVerify --> AnswerCheck[éªŒè¯ç­”æ¡ˆæ­£ç¡®æ€§]
    MultiStep --> AnswerCheck
    Skip --> AnswerCheck
    
    AnswerCheck --> ExplanationCheck[éªŒè¯è§£æé€»è¾‘æ€§<br/>å¦‚æœæ¶‰åŠå¤šæ­¥è®¡ç®—<br/>æ£€æŸ¥æ˜¯å¦è¯´æ˜æ‰€æœ‰æ­¥éª¤]
    
    ExplanationCheck --> Decision{éªŒè¯ç»“æœ}
    Decision -->|é€šè¿‡| Pass[âœ… é€šè¿‡]
    Decision -->|éœ€ä¿®å¤| Retry{retry_count}
    
    Retry -->|â‰¥3| SelfHeal[ğŸ›¡ï¸ è‡ªæ„ˆè¾“å‡º]
    Retry -->|<3| IssueType{é—®é¢˜ç±»å‹}
    
    IssueType -->|è½»å¾®é—®é¢˜| Fixer[Fixer Node<br/>ä¿®å¤]
    IssueType -->|ä¸¥é‡é—®é¢˜| Router[Router Node<br/>é‡æ–°è·¯ç”±]
    
    Fixer --> Start
    Router --> Start
    Pass --> End([âœ… è¾“å‡ºé¢˜ç›®])
    SelfHeal --> End
    
    style Start fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style Extract fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style Calc fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style StepAnalysis fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style AnswerCheck fill:#ffe1e1,stroke:#cc0000,stroke-width:2px
    style Pass fill:#e1ffe1,stroke:#00cc00,stroke-width:3px
    style Fixer fill:#e1ffe1,stroke:#4caf50,stroke-width:2px
    style Router fill:#e1f5ff,stroke:#0066cc,stroke-width:2px
    style End fill:#e1ffe1,stroke:#00cc00,stroke-width:3px
```

## æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§å›¾

```mermaid
mindmap
  root((æ™ºèƒ½å‡ºé¢˜ç³»ç»Ÿ))
    è´¨é‡ä¿éšœ
      å¤šå±‚éªŒè¯
      ç­”æ¡ˆæ­£ç¡®æ€§
      è§£æé€»è¾‘æ€§
      è®¡ç®—ç»“æœéªŒè¯
    è‡ªé€‚åº”ä¿®å¤
      è½»å¾®é—®é¢˜ â†’ Fixer
      ä¸¥é‡é—®é¢˜ â†’ Router
      è‡ªæ„ˆæœºåˆ¶
    æ™ºèƒ½è®¡ç®—
      è®¡ç®—æ­¥éª¤åˆ†æ
      å¤šæ­¥è®¡ç®—æ”¯æŒ
      å‚æ•°æå–è§„åˆ™
    çµæ´»å‡ºé¢˜
      çµæ´»æ¨¡å¼
      ä¸¥è°¨æ¨¡å¼
      åœºæ™¯åŒ–è¡¨è¾¾
    å®¹é”™èƒ½åŠ›
      é”™è¯¯å¤„ç†
      é‡è¯•æœºåˆ¶
      çŠ¶æ€æ¸…ç†
    å¯è§‚æµ‹æ€§
      æ—¥å¿—è®°å½•
      å†³ç­–èŠ‚ç‚¹
      è¿‡ç¨‹å¯è§†åŒ–
```

## èŠ‚ç‚¹åŠŸèƒ½è¯´æ˜

| èŠ‚ç‚¹ | åŠŸèƒ½ | å…³é”®ç‰¹æ€§ |
|------|------|----------|
| **Router Node** | è·¯ç”±å†³ç­– | åˆ†æçŸ¥è¯†ç‚¹ã€è®¡ç®—ç›¸å…³åº¦ã€æå–æŒæ¡ç¨‹åº¦ |
| **Finance Node** | é‡‘èé¢˜ç”Ÿæˆ | ç…§çŒ«ç”»è™ã€è®¡ç®—æ­¥éª¤åˆ†æã€å‚æ•°æå–ã€è°ƒç”¨è®¡ç®—å™¨ |
| **Specialist Node** | æ³•å¾‹/ç»¼åˆé¢˜ç”Ÿæˆ | ç…§çŒ«ç”»è™ã€ç”Ÿæˆåˆç¨¿ |
| **Writer Node** | æ ¼å¼åŒ– | æ ‡å‡†åŒ– JSON è¾“å‡º |
| **Critic Node** | è´¨é‡éªŒè¯ | å‚æ•°æå–ã€è®¡ç®—æ­¥éª¤éªŒè¯ã€ç­”æ¡ˆéªŒè¯ã€è§£æéªŒè¯ |
| **Fixer Node** | é”™è¯¯ä¿®å¤ | æœ¬åœ°ä¿®å¤ã€å¾ªç¯å›åˆ° Critic |
| **è‡ªæ„ˆæœºåˆ¶** | å®¹é”™ä¿æŠ¤ | retry_countâ‰¥3 æ—¶è‡ªåŠ¨è¾“å‡º |

## ç³»ç»Ÿä¼˜åŠ¿

1. ğŸ¯ **è´¨é‡ä¿éšœ**: å¤šå±‚éªŒè¯ç¡®ä¿é¢˜ç›®å‡†ç¡®æ€§
2. ğŸ”„ **è‡ªé€‚åº”ä¿®å¤**: æ ¹æ®é—®é¢˜ä¸¥é‡ç¨‹åº¦é€‰æ‹©ä¿®å¤ç­–ç•¥
3. ğŸ›¡ï¸ **å®¹é”™èƒ½åŠ›**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
4. ğŸ“Š **å¯è§‚æµ‹æ€§**: å®Œæ•´çš„æ—¥å¿—è®°å½•æ¯ä¸ªå†³ç­–èŠ‚ç‚¹
5. ğŸ§® **æ™ºèƒ½è®¡ç®—**: ç†è§£è®¡ç®—æ­¥éª¤ï¼Œæ”¯æŒå¤šæ­¥è®¡ç®—éªŒè¯
6. ğŸ¨ **çµæ´»å‡ºé¢˜**: æ”¯æŒçµæ´»/ä¸¥è°¨ä¸¤ç§æ¨¡å¼ï¼Œé€‚åº”ä¸åŒåœºæ™¯
7. ğŸ¯ **ç²¾å‡†å‚æ•°**: ä¸¥æ ¼çš„å‚æ•°æå–è§„åˆ™ï¼Œç¡®ä¿è®¡ç®—å‡†ç¡®æ€§

