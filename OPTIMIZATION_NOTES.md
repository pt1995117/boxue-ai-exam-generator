# 首次生成慢的原因分析和优化建议

## 可能的原因

1. **首次知识库加载**（第一次运行）
   - 需要加载 1712 条知识点
   - 需要加载 408 道历史题目
   - 需要建立索引（TF-IDF）
   - 需要加载知识点映射文件
   - **解决**: 已经使用 `@st.cache_resource` 缓存，第二次会很快

2. **API调用没有超时设置**
   - 如果网络慢或API响应慢，会一直等待
   - **解决**: 添加超时设置（已在代码中添加）

3. **DeepSeek Reasoner 推理时间长**
   - Reasoner 模型需要更多时间进行推理
   - 每次调用可能需要 10-30 秒
   - 这是正常的，因为模型在"思考"

4. **缺少进度提示**
   - 用户在等待时看不到任何反馈
   - **解决**: 添加进度提示（已在代码中添加）

## 优化建议

1. ✅ 已添加超时设置（120秒）
2. ✅ 已添加初始进度提示
3. 可以考虑：
   - 在首次加载知识库时显示进度条
   - 在API调用时显示"正在思考..."提示
   - 优化知识库加载速度（如果可能）

## 预期时间

- 首次知识库加载：3-5秒（仅第一次）
- Router 节点：5-10秒（调用API）
- Specialist/Finance 节点：10-30秒（调用API）
- Writer 节点：5-10秒（调用API）
- Critic 节点：10-30秒（调用API）
- **总计：30-80秒（取决于API响应速度）**

这是正常的，因为每次都需要调用LLM进行推理。

